<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />


  <!-- Favicon reference -->
  <link rel="icon" type="image/x-icon" href="../Assignment-5/assets/img/Favicon/favicon.ico"/>
  <!--BootStrap style sheet-->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Bellota:wght@700&display=swap" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"/>
  <!-- Own style sheet-->
  <link rel="stylesheet" href="./assets/css/style.css"/>

  <title>Work Day Scheduler</title>
</head>

<body>
  <!-- header with title, app description, current day, date and year, and dark/light mode toggle -->
  <header class="jumbotron">
    <h1 class="display-3">Work Day Scheduler</h1>
    <p id="currentDay" class="lead"></p>
    <h3 id="headerDate"></h3>
  </header>

  <!-- Time blocks -->
  <div class="container">
    <!-- 9am -->
    <div class="input-group">
      <div class="input-group-prepend">
        <span class="input-group-text paddingFix">9am</span>
      </div>
      <textarea class="form-control" aria-label="With textarea" data-columns="0"></textarea>
    </div>

    <!-- 10am -->
    <div class="input-group">
      <div class="input-group-prepend">
        <span class="input-group-text">10am</span>
      </div>
      <textarea class="form-control" aria-label="With textarea" data-columns="1"></textarea>
    </div>

    <!-- 11am -->
    <div class="input-group">
      <div class="input-group-prepend">
        <span class="input-group-text">11am</span>
      </div>
      <textarea class="form-control" aria-label="With textarea" data-columns="2"></textarea>
    </div>

    <!-- 12pm -->
    <div class="input-group">
      <div class="input-group-prepend">
        <span class="input-group-text">12pm</span>
      </div>
      <textarea class="form-control" aria-label="With textarea" data-columns="3"></textarea>
    </div>

    <!-- 1pm -->
    <div class="input-group">
      <div class="input-group-prepend">
        <span class="input-group-text paddingFix">1pm</span>
      </div>
      <textarea class="form-control" aria-label="With textarea" data-columns="4"></textarea>
    </div>

    <!-- 2pm -->
    <div class="input-group">
      <div class="input-group-prepend">
        <span class="input-group-text paddingFix">2pm</span>
      </div>
      <textarea class="form-control" aria-label="With textarea" data-columns="5"></textarea>
    </div>

    <!-- 3pm -->
    <div class="input-group">
      <div class="input-group-prepend">
        <span class="input-group-text paddingFix">3pm</span>
      </div>
      <textarea class="form-control" aria-label="With textarea" data-columns="6"></textarea>
    </div>

    <!-- 4pm -->
    <div class="input-group">
      <div class="input-group-prepend">
        <span class="input-group-text paddingFix">4pm</span>
      </div>
      <textarea class="form-control" aria-label="With textarea" data-columns="7"></textarea>
    </div>

    <!-- 5pm -->
    <div class="input-group">
      <div class="input-group-prepend">
        <span class="input-group-text paddingFix">5pm</span>
      </div>
      <textarea class="form-control" aria-label="With textarea" data-columns="8"></textarea>
    </div>

  </div>

  <!-- Modal for task Input -->
  <div class="modal" tabindex="-1" role="dialog" id="myModal">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-body">
          <div class="form-group">
            <label for="message-text" class="col-form-label">Enter Task:<span id="blockId"
                style="color:deeppink" hidden></span></label>
            <textarea id="taskInput"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal"><i class="far fa-window-close"></i> Close</button>
          <button type="button" id="saveButton" class="btn btn-dark"><i class="far fa-calendar-plus"></i> Add</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Moment.js script link -->
  <script src="./assets/lib/moment/moment.with-local.js"></script>
  <!-- jquery  script link -->
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <!-- Bootstrap script link -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>


  <script>

    //moment object
    var moment = moment();

    //Display day, month, date, year
    $("#headerDate").html((moment.format("dddd," + " MMMM Do YYYY")));

    //Get tasks from local storage
    var getUserTasks = JSON.parse(localStorage.getItem("userTasks"));

    console.log(getUserTasks);

    // If local storage is null create time block object
    if (getUserTasks !== null) {
      timeBlockTasks = getUserTasks;
    } else {

      var timeBlockTasks = {
        timeBlocks: new Array(9)
      };

    };

    //start time 9am
    var startTime = 9;
    //Calculate current time to the hour
    var currentTime = moment.hour();
    //duration from start time to current time
    var timeDiff = currentTime - startTime;

    //Clear text Area if past 6pm
    // if (timeDiff === 9) {
    //   localStorage.clear()
    // }

    // past, present, future color coordination
    $(".form-control").each(function () {

      if (timeDiff === ($(this).data("columns"))) {
        $(this).css("background-color", "palevioletred");
      } else if (($(this).data("columns")) < timeDiff) {
        $(this).css("background-color", "currentcolor");
      } else if (($(this).data("columns")) > timeDiff) {
        $(this).css("background-color", "darkseagreen");
      }

    });

    //Event listener for text area to display Modal
    $(".form-control").on("click", function () {
      $('#myModal').modal('show');

      //get block column value
      var $blockId = $(".form-control").index(this);

      $("#blockId").text($blockId);

    });


    //Save button function 
    $("#saveButton").on("click", function () {

      var $taskInput = $("#taskInput");

      var $blockId = $("#blockId").text();

      //Access Array for time block user input
      var timeBlockArr = timeBlockTasks.timeBlocks;

      for (var i = 0; i < timeBlockArr.length; i++) {

        if (i == $blockId) {
          timeBlockArr[i] = $taskInput.val().trim();

          console.log(timeBlockArr);
          break;
        }
      }

      //stringify user input
      var timeBlockTasks_serialized = JSON.stringify(timeBlockTasks);

      //save to local storage
      localStorage.setItem("userTasks", timeBlockTasks_serialized);

      //get user input from local storage and covert back to string
      // var timeBlockTasks_deserialized = JSON.parse(localStorage.getItem("userTasks"));

      // //clear text
      $taskInput.val("");

      $('#myModal').modal('hide');

    });


  </script>

</body>

</html>